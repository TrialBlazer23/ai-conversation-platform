<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Conversation Platform - Multi-Model Orchestrator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Markdown and Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ü§ñ AI Conversation Platform</h1>
            <p class="subtitle">Multi-model orchestration with streaming, memory, and full control</p>
            <div class="header-stats" id="global-stats" style="display: none;">
                <span class="stat">üí¨ <span id="total-messages">0</span> messages</span>
                <span class="stat">üéØ <span id="total-tokens">0</span> tokens</span>
                <span class="stat">üí∞ $<span id="total-cost">0.00</span></span>
            </div>
        </header>

        <div class="main-content">
            <!-- Conversation History Sidebar -->
            <div id="history-sidebar" class="history-sidebar collapsed">
                <div class="sidebar-header">
                    <h3>üí¨ History</h3>
                    <button id="toggle-history-btn" class="btn-icon" title="Toggle sidebar">‚óÄ</button>
                </div>
                <div class="sidebar-controls">
                    <button id="show-all-btn" class="btn btn-sm btn-secondary">All</button>
                    <button id="show-favorites-btn" class="btn btn-sm btn-outline">‚≠ê Favorites</button>
                </div>
                <div class="sidebar-content" id="history-list">
                    <div class="loading-history">Loading conversations...</div>
                </div>
            </div>

            <!-- Configuration Panel -->
            <div id="config-panel" class="panel">
                <h2>‚öôÔ∏è Configuration</h2>
                
                <div class="section">
                    <div class="section-header">
                        <h3>Quick Start Templates</h3>
                    </div>
                    <div id="templates-container" class="templates-grid">
                        <div class="template-card skeleton">Loading templates...</div>
                    </div>
                </div>

                <div class="section">
                    <h3>API Keys</h3>
                    <div class="api-keys-grid">
                        <div class="form-group">
                            <label for="openai-key">
                                <span class="provider-icon">üîµ</span> OpenAI API Key:
                            </label>
                            <input type="password" id="openai-key" placeholder="sk-...">
                        </div>
                        <div class="form-group">
                            <label for="anthropic-key">
                                <span class="provider-icon">üü£</span> Anthropic API Key:
                            </label>
                            <input type="password" id="anthropic-key" placeholder="sk-ant-...">
                        </div>
                        <div class="form-group">
                            <label for="google-key">
                                <span class="provider-icon">üî¥</span> Google API Key:
                            </label>
                            <input type="password" id="google-key" placeholder="AIza...">
                        </div>
                        <div class="form-group">
                            <label for="ollama-status">
                                <span class="provider-icon">üè†</span> Ollama (Local):
                            </label>
                            <div class="ollama-status">
                                <span id="ollama-status" class="status-indicator">Checking...</span>
                                <button id="refresh-ollama-btn" class="btn-icon" title="Refresh local models">üîÑ</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h3>Model Configuration</h3>
                        <span class="help-text">Configure 2+ models for conversation</span>
                    </div>
                    <div id="models-container"></div>
                    <button id="add-model-btn" class="btn btn-secondary btn-block">
                        <span class="btn-icon">‚ûï</span> Add Model
                    </button>
                </div>

                <div class="section">
                    <h3>Initial Prompt</h3>
                    <textarea id="initial-prompt" rows="4" placeholder="Enter the initial prompt to start the conversation..."></textarea>
                    <div class="prompt-stats" id="prompt-stats"></div>
                </div>

                <div class="button-group">
                    <button id="save-config-btn" class="btn btn-primary">
                        <span class="btn-icon">üíæ</span> Save Configuration
                    </button>
                    <button id="start-conversation-btn" class="btn btn-success">
                        <span class="btn-icon">üöÄ</span> Start Conversation
                    </button>
                </div>
            </div>

            <!-- Conversation Panel -->
            <div id="conversation-panel" class="panel conversation-panel" style="display: none;">
                <div class="conversation-header">
                    <div class="header-left">
                        <h2>üí¨ Conversation</h2>
                        <div class="conversation-meta" id="conversation-meta"></div>
                    </div>
                    <div class="controls">
                        <button id="streaming-toggle" class="btn btn-sm btn-secondary" title="Toggle streaming mode">
                            <span class="btn-icon">‚ö°</span> Streaming: <span id="streaming-status">ON</span>
                        </button>
                        <button id="auto-mode-btn" class="btn btn-sm btn-primary">
                            <span class="btn-icon">‚ñ∂Ô∏è</span> Auto Mode
                        </button>
                        <button id="next-turn-btn" class="btn btn-sm btn-secondary">
                            <span class="btn-icon">‚è≠Ô∏è</span> Next Turn
                        </button>
                        <button id="export-btn" class="btn btn-sm btn-secondary">
                            <span class="btn-icon">üì•</span> Export
                        </button>
                        <button id="new-conversation-btn" class="btn btn-sm btn-secondary">
                            <span class="btn-icon">üÜï</span> New
                        </button>
                    </div>
                </div>

                    <!-- Conversation Search & Filter -->
                    <div class="conversation-search-bar">
                        <input type="text" id="conversation-search-input" placeholder="üîç Search conversations..." class="search-input" />
                        <select id="conversation-search-model" class="search-select">
                            <option value="">All Models</option>
                            <option value="gemini-2.0-flash-exp">Gemini 2.0 Flash</option>
                            <option value="gpt-4">GPT-4</option>
                            <option value="claude-3-opus-20240229">Claude 3 Opus</option>
                        </select>
                        <select id="conversation-search-status" class="search-select">
                            <option value="">All Statuses</option>
                            <option value="active">Active</option>
                            <option value="archived">Archived</option>
                            <option value="completed">Completed</option>
                        </select>
                        <label class="favorites-filter-label">
                            <input type="checkbox" id="conversation-search-favorites" class="favorites-checkbox" />
                            <span class="favorites-filter-text">‚≠ê Favorites Only</span>
                        </label>
                        <input type="date" id="conversation-search-start-date" class="search-date" />
                        <input type="date" id="conversation-search-end-date" class="search-date" />
                        <button id="conversation-search-btn" class="btn btn-sm btn-primary">Search</button>
                    </div>

                <!-- Token Usage Bar -->
                <div class="token-usage-container">
                    <div class="token-usage-header">
                        <span class="token-label">Context Window</span>
                        <span class="token-stats" id="token-stats">0 / 0 tokens</span>
                    </div>
                    <div class="token-progress-bar">
                        <div class="token-progress-fill" id="token-progress-fill" style="width: 0%"></div>
                    </div>
                    <div class="token-warning" id="token-warning" style="display: none;">
                        ‚ö†Ô∏è Approaching token limit - conversation may be truncated
                    </div>
                </div>

                <div id="messages-container" class="messages"></div>

                <div id="edit-panel" class="edit-panel" style="display: none;">
                    <h3>‚úèÔ∏è Edit Message Before Sending</h3>
                    <textarea id="edit-message" rows="6"></textarea>
                    <div class="button-group">
                        <button id="send-edited-btn" class="btn btn-primary">
                            <span class="btn-icon">üì§</span> Send Edited
                        </button>
                        <button id="send-original-btn" class="btn btn-secondary">
                            <span class="btn-icon">üì®</span> Send Original
                        </button>
                        <button id="cancel-edit-btn" class="btn btn-secondary">
                            <span class="btn-icon">‚ùå</span> Cancel
                        </button>
                    </div>
                </div>

                <div id="status-bar" class="status-bar">
                    <div class="status-left">
                        <span id="status-text">Ready</span>
                    </div>
                    <div class="status-right">
                        <span id="next-model-text"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    
    <!-- Application Scripts -->
    <script src="{{ url_for('static', filename='js/notifications.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ui-enhancements.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
